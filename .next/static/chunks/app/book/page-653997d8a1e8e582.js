(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[886],{9449:function(e,t,r){Promise.resolve().then(r.bind(r,1122))},1122:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var a=r(7437),n=r(2265);let l="cmfmtab9i0000nc4owma6zi5i";function s(e){return String(e).padStart(2,"0")}function i(e){return"".concat(e.getFullYear(),"-").concat(s(e.getMonth()+1),"-").concat(s(e.getDate()))}function o(e){let[t,r,a]=e.split("-").map(Number);return new Date(t,(null!=r?r:1)-1,null!=a?a:1,0,0,0,0)}function d(e){let t=new Date(e),r=t.getDay();return t.setDate(t.getDate()-(r+6)%7),t.setHours(0,0,0,0),t}function c(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function u(e){return e.replace(/\D/g,"").length>=7}function m(e){return e.trim().length>=5}function g(){let[e,t]=(0,n.useState)(()=>i(new Date)),[r,s]=(0,n.useState)({}),[g,v]=(0,n.useState)(!1),[y,j]=(0,n.useState)(null),[k,w]=(0,n.useState)(null),[N,D]=(0,n.useState)(""),[S,C]=(0,n.useState)(""),[T,E]=(0,n.useState)(""),[F,A]=(0,n.useState)(""),[I,B]=(0,n.useState)({}),[M,O]=(0,n.useState)(!1),[Y,_]=(0,n.useState)(null),[q,z]=(0,n.useState)(null),V=(0,n.useRef)(null),K=(0,n.useCallback)(async()=>{v(!0),j(null);try{let t=await fetch("/api/contact/open/week?resourceId=".concat(l,"&week=").concat(e),{cache:"no-store"}),r=await t.json();if(!t.ok)throw Error("Kunde inte h\xe4mta lediga tider.");s(r.days||{})}catch(e){var t;j(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Ett fel uppstod n\xe4r tider skulle h\xe4mtas."),s({})}finally{v(!1)}},[e]);function L(r){let a=o(e);a.setDate(a.getDate()+7*r),t(i(a)),w(null),_(null),z(null)}(0,n.useEffect)(()=>{K()},[K]);let P=(0,n.useMemo)(()=>{let t=d(o(e));return Array.from({length:7},(e,a)=>{let n=new Date(t);n.setDate(t.getDate()+a);let l=i(n);return{key:l,label:new Intl.DateTimeFormat("sv-SE",{weekday:"short",day:"numeric"}).format(n),slots:r[l]||[]}})},[e,r]),R=(0,n.useMemo)(()=>Object.values(r).some(e=>((null==e?void 0:e.length)||0)>0),[r]);async function H(e){e.preventDefault(),z(null),_(null);let t=!!N.trim(),r=c(S),a=u(T),n=m(F);if(!k){z("V\xe4lj en tid f\xf6rst.");return}if(!t||!r||!a||!n){B({name:!0,email:!0,phone:!0,address:!0}),z("Kontrollera att alla f\xe4lt \xe4r korrekt ifyllda.");return}O(!0);try{let e=await fetch("/api/contact/book",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resourceId:l,startIso:new Date(k).toISOString(),name:N,email:S,phone:T,address:F})}),t=await e.json();if(!e.ok||!(null==t?void 0:t.ok))throw Error((null==t?void 0:t.error)||"Kunde inte boka tiden.");_("Tack! Din bokningsf\xf6rfr\xe5gan \xe4r mottagen. Vi \xe5terkommer med bekr\xe4ftelse."),s(e=>{let t=new Date(k),r=i(t),a={...e};return a[r]=(a[r]||[]).filter(e=>e.iso!==k),a}),w(null),B({})}catch(e){var o;z(null!==(o=null==e?void 0:e.message)&&void 0!==o?o:"Ett fel uppstod.")}finally{O(!1)}}let G=k?new Date(k).toLocaleString("sv-SE"):"Ingen vald";return(0,a.jsxs)("main",{className:"mx-auto max-w-5xl p-4",children:[(0,a.jsxs)("header",{className:"mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Boka en tid"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"V\xe4lj en ledig tid och fyll i dina uppgifter. Tider visas i din lokala tidszon."})]}),(0,a.jsx)("section",{ref:V,tabIndex:0,onKeyDown:e=>{"ArrowLeft"===e.key?(e.preventDefault(),L(-1)):"ArrowRight"===e.key&&(e.preventDefault(),L(1))},"aria-label":"Veckonavigering",className:"sticky top-0 z-10 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>L(-1),className:"rounded-full border border-gray-300 px-3 py-1 text-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-600","aria-label":"F\xf6reg\xe5ende vecka",children:"Tidigare"}),(0,a.jsx)("button",{onClick:()=>L(1),className:"rounded-full border border-gray-300 px-3 py-1 text-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-600","aria-label":"N\xe4sta vecka",children:"Senare"})]}),(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700","aria-live":"polite",children:function(e){let t=o(e),r=d(t),a=function(e){let t=d(e),r=new Date(t);return r.setDate(t.getDate()+6),r.setHours(23,59,59,999),r}(t),n=new Intl.DateTimeFormat("sv-SE",{day:"numeric",month:"short"}),l=r.getMonth()===a.getMonth(),s=n.format(r),i=l?new Intl.DateTimeFormat("sv-SE",{day:"numeric"}).format(a):n.format(a),c=r.getFullYear()===a.getFullYear()?r.getFullYear():"".concat(r.getFullYear(),"–").concat(a.getFullYear());return"".concat(s,"–").concat(i," ").concat(c)}(e)})]})}),y&&(0,a.jsxs)(f,{kind:"error",onRetry:K,children:[y," ",(0,a.jsx)("span",{className:"sr-only",children:"."})]}),(0,a.jsx)("section",{className:"mt-4",children:g?(0,a.jsx)(p,{}):(0,a.jsxs)(a.Fragment,{children:[!R&&(0,a.jsx)("div",{className:"mb-6 rounded-xl border border-gray-200 p-4 text-sm text-gray-700 bg-white",children:"Det finns inga lediga tider den h\xe4r veckan. Prova att byta vecka med knapparna ovan."}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-6",children:P.map(e=>{let{key:t,label:r,slots:n}=e;return(0,a.jsx)(x,{label:r,empty:0===n.length,children:0===n.length?(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Inga lediga tider"}):(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(e=>{let t=k===e.iso;return(0,a.jsx)(h,{label:e.label,iso:e.iso,active:t,onSelect:()=>w(e.iso)},e.iso)})})},t)})})]})}),(0,a.jsxs)("section",{"aria-live":"polite",className:"max-w-xl",children:[q&&(0,a.jsx)(f,{kind:"warning",children:q}),Y&&null===k&&(0,a.jsxs)("div",{className:"mb-4 rounded-xl border border-emerald-200 bg-emerald-50 p-4 text-emerald-900",children:[(0,a.jsx)("h2",{className:"font-medium mb-1",children:"Tack!"}),(0,a.jsx)("p",{className:"text-sm",children:Y}),(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{D(""),C(""),E(""),A(""),B({}),_(null),z(null)},className:"rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-600",children:"Boka en till tid"}),(0,a.jsx)("button",{onClick:()=>{t(i(new Date)),w(null)},className:"rounded-lg bg-emerald-600 text-white px-3 py-1.5 text-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-600",children:"G\xe5 till denna vecka"})]})]})]}),(0,a.jsxs)("form",{onSubmit:H,className:"border rounded-2xl p-4 md:p-6 space-y-4 max-w-xl bg-white shadow-sm","aria-busy":M?"true":"false",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Dina uppgifter"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"selected",className:"block text-sm font-medium",children:"Vald tid"}),(0,a.jsx)("input",{id:"selected",className:"mt-1 w-full border rounded-lg px-3 py-2 bg-gray-50",value:G,readOnly:!0}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Tider visas i din lokala tidszon."})]}),(0,a.jsx)(b,{id:"name",label:"Namn",value:N,onChange:e=>D(e),onBlur:()=>B(e=>({...e,name:!0})),autoComplete:"name",required:!0,invalid:I.name&&!N.trim(),errorText:"Ange ditt namn."}),(0,a.jsx)(b,{id:"email",type:"email",label:"E-post",value:S,onChange:e=>C(e),onBlur:()=>B(e=>({...e,email:!0})),autoComplete:"email",required:!0,invalid:I.email&&!c(S),errorText:"Ange en giltig e-postadress."}),(0,a.jsx)(b,{id:"phone",label:"Telefon",inputMode:"tel",autoComplete:"tel",value:T,onChange:e=>E(e),onBlur:()=>B(e=>({...e,phone:!0})),required:!0,invalid:I.phone&&!u(T),errorText:"Ange ett giltigt telefonnummer."}),(0,a.jsx)(b,{id:"address",label:"Adress",value:F,onChange:e=>A(e),onBlur:()=>B(e=>({...e,address:!0})),autoComplete:"street-address",required:!0,invalid:I.address&&!m(F),errorText:"Ange en fullst\xe4ndig adress."}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{type:"submit",disabled:!k||M,className:"rounded-xl px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-emerald-600",children:M?"Skickar…":"Skicka bokningsf\xf6rfr\xe5gan"})})]})]})}function x(e){let{label:t,empty:r,children:n}=e;return(0,a.jsxs)("div",{className:"border rounded-xl p-3 bg-white shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("div",{className:"font-medium capitalize",children:t}),r&&(0,a.jsx)("span",{className:"text-xs text-gray-400","aria-hidden":!0,children:"–"})]}),n]})}function h(e){let{label:t,iso:r,active:n,onSelect:l}=e;return(0,a.jsx)("button",{type:"button",onClick:l,"aria-pressed":n,className:"text-sm rounded-full px-3 py-1 border transition focus:outline-none focus:ring-2 focus:ring-emerald-600 ".concat(n?"bg-emerald-600 text-white border-emerald-600":"bg-white hover:bg-gray-50 border-gray-300"),title:new Date(r).toLocaleString("sv-SE"),children:t})}function f(e){let{kind:t="info",children:r,onRetry:n}=e;return(0,a.jsxs)("div",{role:"error"===t?"alert":"status",className:"mb-4 rounded-xl border p-3 ".concat("error"===t?"border-red-200 bg-red-50 text-red-900":"warning"===t?"border-amber-200 bg-amber-50 text-amber-900":"border-gray-200 bg-gray-50 text-gray-900"),children:[(0,a.jsx)("div",{className:"text-sm",children:r}),n&&(0,a.jsx)("button",{onClick:n,className:"mt-2 rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-600",children:"F\xf6rs\xf6k igen"})]})}function b(e){let{id:t,label:r,value:n,onChange:l,onBlur:s,type:i="text",inputMode:o,autoComplete:d,required:c,invalid:u,errorText:m}=e,g=u?"".concat(t,"-error"):void 0;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:t,className:"block text-sm font-medium",children:[r," ",c&&(0,a.jsx)("span",{className:"text-red-600","aria-hidden":!0,children:"*"})]}),(0,a.jsx)("input",{id:t,type:i,inputMode:o,autoComplete:d,className:"mt-1 w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-600 ".concat(u?"border-red-500":""),value:n,onChange:e=>l(e.target.value),onBlur:s,"aria-invalid":u?"true":"false","aria-describedby":g,required:c}),u&&m&&(0,a.jsx)("p",{id:"".concat(t,"-error"),className:"mt-1 text-sm text-red-600",children:m})]})}function p(){return(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-6",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-xl p-3 bg-white shadow-sm",children:[(0,a.jsx)("div",{className:"h-4 w-24 bg-gray-200 rounded mb-3 animate-pulse"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Array.from({length:4}).map((e,t)=>(0,a.jsx)("div",{className:"h-7 w-16 bg-gray-200 rounded-full animate-pulse"},t))})]},t))})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=9449)}),_N_E=e.O()}]);