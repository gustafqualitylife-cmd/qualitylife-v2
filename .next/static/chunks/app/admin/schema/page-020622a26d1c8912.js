(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{474:function(e,t,n){Promise.resolve().then(n.bind(n,9776))},9776:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(7437),r=n(2265);let o="cmfmtab9i0000nc4owma6zi5i",c=["10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00"];function l(e){return String(e).padStart(2,"0")}function s(e){return"".concat(e.getFullYear(),"-").concat(l(e.getMonth()+1),"-").concat(l(e.getDate()))}function i(e){let[t,n,a]=e.split("-").map(Number);return new Date(t,(null!=n?n:1)-1,null!=a?a:1,0,0,0,0)}function u(e){let t=new Date(e),n=t.getDay();return t.setDate(t.getDate()-(n+6)%7),t.setHours(0,0,0,0),t}function d(){let[e,t]=(0,r.useState)(()=>s(new Date)),[n,l]=(0,r.useState)({}),[d,m]=(0,r.useState)({}),p=(0,r.useRef)(new Set),f=(0,r.useMemo)(()=>{let t=u(i(e)),n=new Date(t);n.setDate(t.getDate()+6);let a=new Intl.DateTimeFormat("sv-SE",{month:"short",day:"numeric"});return"".concat(a.format(t).toUpperCase()," – ").concat(a.format(n).toUpperCase())},[e]);async function w(){let t=await fetch("/api/contact/open/week?resourceId=".concat(o,"&week=").concat(e),{cache:"no-store"});l((await t.json()).days||{})}async function h(e){var t;let n=await fetch("/api/contact/open/week?resourceId=".concat(o,"&week=").concat(e),{cache:"no-store"}),a=await n.json();return null!==(t=null==a?void 0:a.days)&&void 0!==t?t:{}}function g(n){let a=i(e);a.setDate(a.getDate()+7*n),t(s(a))}(0,r.useEffect)(()=>{w()},[e]);let b=(0,r.useMemo)(()=>{let t=u(i(e));return Array.from({length:7},(e,a)=>{let r=new Date(t);r.setDate(t.getDate()+a);let o=s(r),c=new Intl.DateTimeFormat("sv-SE",{weekday:"short",day:"numeric"}).format(r),l=new Set((n[o]||[]).map(e=>e.label));return{key:o,label:c,openSet:l}})},[e,n]);function x(e,t){return"".concat(e,"|").concat(t)}async function y(t,n,a){let r=x(t,n);if(!p.current.has(r)){p.current.add(r),l(e=>{let r={...e},o=r[t]?[...r[t]]:[],c=o.some(e=>e.label===n);if(a)c||o.push({iso:"",label:n});else if(c){let e=o.filter(e=>e.label!==n);return r[t]=e,r}return r[t]=o,r}),m(e=>({...e,[r]:!0}));try{var c;let r=new Date("".concat(t,"T").concat(n,":00")).toISOString(),s=await fetch("/api/contact/admin/open/toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resourceId:o,date:t,time:n,startIso:r,desired:a?"open":"closed"})}),i=await s.json().catch(()=>({}));if(!s.ok||!(null==i?void 0:i.ok))throw Error((null==i?void 0:i.error)||"HTTP ".concat(s.status));await new Promise(e=>setTimeout(e,120));let u=await h(e),d=new Set((null!==(c=u[t])&&void 0!==c?c:[]).map(e=>e.label));a!==d.has(n)&&(await new Promise(e=>setTimeout(e,200)),u=await h(e)),l(u)}catch(e){console.error("Toggle failed",e),await w()}finally{m(e=>{let t={...e};return delete t[r],t}),p.current.delete(r)}}}return(0,a.jsxs)("main",{className:"mx-auto max-w-4xl p-4",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold mb-2",children:"Admin – \xf6ppna tider"}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("button",{onClick:()=>g(-1),className:"rounded-full border px-3 py-1",children:"Tidigare"}),(0,a.jsx)("div",{className:"text-sm uppercase tracking-wide",children:f}),(0,a.jsx)("button",{onClick:()=>g(1),className:"rounded-full border px-3 py-1",children:"Senare"})]}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2 text-sm",children:b.map(e=>{let{key:t,label:n,openSet:r}=e;return(0,a.jsxs)("div",{className:"border rounded-lg p-2",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:n}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:c.map(e=>{let n=r.has(e),o=!0===d[x(t,e)];return(0,a.jsxs)("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),o||y(t,e,!n)},disabled:o,className:"rounded-xl px-3 py-2 border ".concat(n?"bg-emerald-50 border-emerald-300":"bg-gray-50 border-gray-300"," ").concat(o?"opacity-60 cursor-not-allowed pointer-events-none":""),children:[e," ",n?"• \xf6ppen":"• st\xe4ngd",o?" (sparar…)":""]},e)})})]},t)})})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=474)}),_N_E=e.O()}]);