"use strict";(()=>{var e={};e.id=974,e.ids=[974],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8738:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>S,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>p,dynamic:()=>l});var o=r(9303),n=r(8716),i=r(3131),s=r(7070),u=r(728);let l="force-dynamic";async function p(e){try{let t=await e.json(),r=t.resourceId,a=t.desired;if(!r)return s.NextResponse.json({ok:!1,error:"Missing resourceId"},{status:400});await u._.resource.upsert({where:{id:r},create:{id:r,name:"Default"},update:{}});let o=function(e,t,r){if(r){let e=new Date(r);return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0))}if(!e||!t)throw Error("Missing date/time");let a=function(e){let[t,r,a]=e.split("-").map(Number);return new Date(t,(r??1)-1,a??1,0,0,0,0)}(e),{h:o,mi:n}=function(e){let[t,r]=e.split(":").map(Number);return{h:t??0,mi:r??0}}(t),i=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),o,n,0,0)),s=(new Date(i.toLocaleString("en-US",{timeZone:"Europe/Stockholm"})).getTime()-i.getTime())/6e4,u=new Date(i.getTime()-6e4*s);return u.setSeconds(0,0),u}(t.date,t.time,t.startIso),n=new Date(o.getTime()+36e5);console.log("ADMIN TOGGLE",{resourceId:r,date:t.date,time:t.time,start:o.toISOString()});let i=await u._.openSlot.findFirst({where:{resourceId:r,start:{gte:new Date(o.getTime()),lt:new Date(o.getTime()+6e4)}}}),l=!1,p=!1;return"open"===a?i||(await u._.openSlot.create({data:{resourceId:r,start:o,end:n}}),l=!0):"closed"===a?i&&(await u._.openSlot.delete({where:{id:i.id}}),p=!0):i?(await u._.openSlot.delete({where:{id:i.id}}),p=!0):(await u._.openSlot.create({data:{resourceId:r,start:o,end:n}}),l=!0),console.log("ADMIN RESULT",{desired:a,created:l,deleted:p,start:o.toISOString()}),s.NextResponse.json({ok:!0,desired:a,created:l,deleted:p,start:o.toISOString()})}catch(e){return console.error("ADMIN SCHEMA ERROR",e),s.NextResponse.json({ok:!1,error:e?.message??"Server error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/contact/admin/open/toggle/route",pathname:"/api/contact/admin/open/toggle",filename:"route",bundlePath:"app/api/contact/admin/open/toggle/route"},resolvedPagePath:"C:\\Users\\gusta\\Desktop\\Webbutveckling\\qualitylife\\src\\app\\api\\contact\\admin\\open\\toggle\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:m}=d,w="/api/contact/admin/open/toggle/route";function S(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},728:(e,t,r)=>{r.d(t,{_:()=>o});let a=require("@prisma/client"),o=global.prisma??new a.PrismaClient}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972],()=>r(8738));module.exports=a})();